# flake8: noqa:E501
import os
import pathlib
from typing import List

import pytest

from app.tools.collectors import StationDataCollector
from app.tools.validators import StationData

# Constants to use in tests
STATION_COLUMN_NAMES = {
    "REGIAO:": "Region",
    "UF:": "State",
    "ESTACAO:": "StationName",
    "CODIGO (WMO):": "IdStationWho",
    "LATITUDE:": "Latitude",
    "LONGITUDE:": "Longitude",
    "ALTITUDE:": "Altitude",
    "DATA DE FUNDACAO:": "FoundingDate",
}

STATIONS_FILE = "stations"


def create_files(
    destiny_folder: pathlib.Path,
    data_to_files: List[str],
) -> None:
    """Helper function to create text files based in a list."""
    for file_number, csv_data in enumerate(data_to_files):
        file_name = "file_" + str(file_number) + ".csv"
        file = destiny_folder / file_name
        file.write_text(csv_data)


@pytest.fixture()
def tmp_station_valid_data(tmp_path):
    """Create a temp folder to test StationDataCollector with valid data."""
    temp_stage_valid = tmp_path / "stage-valid"
    temp_stage_valid.mkdir()
    temp_output_valid = tmp_path / "output-valid"
    temp_output_valid.mkdir()
    csv_data_infos = [
        """REGIAO:;CO
UF:;DF
ESTACAO:;BRASILIA
CODIGO (WMO):;A001
LATITUDE:;-15,78944444
LONGITUDE:;-47,92583332
ALTITUDE:;1160,96
DATA DE FUNDACAO:;07/05/00
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;0;887,7;887,7;887,2;;20,1;17,9;20,9;20;19,2;17,8;91;87;87;187;3,3;1,2;
2023/01/01;0100 UTC;0;888,1;888,1;887,7;;19,2;17,5;20,1;19,2;17,8;17,4;90;87;90;153;2,9;,8;
2023/01/01;0200 UTC;0;887,8;888,1;887,8;;19,3;17,6;19,5;19;17,8;17,3;90;89;90;145;2,5;1,5;
2023/01/01;0300 UTC;0;887,8;887,9;887,7;;19,3;17,7;19,4;19,1;17,8;17,5;91;90;91;162;3,2;1,4;
2023/01/01;0400 UTC;0;887,6;887,9;887,6;;19,7;18,1;19,7;19,1;18,1;17,4;91;90;90;140;5,7;2,7;
2023/01/01;0500 UTC;0;886,7;887,6;886,7;;19,1;17,7;19,7;19,1;18,1;17,7;92;90;92;128;7,1;2;""",
        """REGIAO:;CO
UF:;DF
ESTACAO:;BRAZLANDIA
CODIGO (WMO):;A042
LATITUDE:;-15,59972221
LONGITUDE:;-48,1311111
ALTITUDE:;1143
DATA DE FUNDACAO:;19/07/17
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;0;888,7;888,9;888,2;;20,5;18;21;20,5;18,4;18;87;84;86;146;3,9;1,8;
2023/01/01;0100 UTC;0;889;889;888,7;;20,4;17,5;20,5;20,3;18;17,5;86;84;84;142;4,1;1,8;
2023/01/01;0200 UTC;0;888,9;889,1;888,9;;19,9;17,4;20,4;19,8;17,5;17,3;86;83;86;153;4;,2;
2023/01/01;0300 UTC;0;888,7;888,9;888,7;;19,8;17,4;19,9;19,7;17,4;17,2;87;85;86;140;3,5;1,2;
2023/01/01;0400 UTC;0;888,4;888,8;888,4;;20,1;17,3;20,1;19,8;17,5;17,3;86;84;84;139;3,3;,3;
2023/01/01;0500 UTC;0;887,8;888,4;887,8;;19,8;17,6;20,3;19,8;17,6;17,2;87;83;87;138;5,2;1,3;
2023/01/01;0600 UTC;0;887,5;887,9;887,5;;19,6;17,3;19,8;19,5;17,7;17,3;89;87;87;133;4,1;,3;
2023/01/01;0700 UTC;0;887,5;887,5;887,3;;19,1;17,3;19,6;19,1;17,3;17,2;89;87;89;95;4,4;1,4;
2023/01/01;0800 UTC;0;887,6;887,6;887,5;;18,9;17,1;19,2;18,3;17,5;16,9;92;89;89;49;5,5;2,4;
2023/01/01;0900 UTC;0;888;888;887,4;5,3;18,8;17;19,1;18,4;17,1;16,6;90;88;89;73;4,8;,6;""",
        """REGIAO:;N
UF:;AM
ESTACAO:;COARI
CODIGO (WMO):;A117
LATITUDE:;-4,09749999
LONGITUDE:;-63,14527777
ALTITUDE:;33,84
DATA DE FUNDACAO:;12/04/08
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0100 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0200 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0300 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0400 UTC;;;;;;;;;;;;;;;;;;""",
    ]

    create_files(temp_stage_valid, csv_data_infos)

    print(tmp_path)

    yield temp_stage_valid, temp_output_valid


@pytest.fixture()
def tmp_station_invalid_data(tmp_path):
    """Create a temp folder to test StationDataCollector with invalid data."""
    temp_stage_invalid = tmp_path / "stage-invalid"
    temp_stage_invalid.mkdir()
    temp_output_invalid = tmp_path / "output-invalid"
    temp_output_invalid.mkdir()

    csv_data_infos = [
        """REGIAO:;CO
UF:;DF
ESTACAO:;BRASILIA
CODIGO (WMO):;A001
LATITUDE:;aaaaaaaaaa
LONGITUDE:;-47,92583332
ALTITUDE:;1160,96
DATA DE FUNDACAO:;07/05/00
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;0;887,7;887,7;887,2;;20,1;17,9;20,9;20;19,2;17,8;91;87;87;187;3,3;1,2;
2023/01/01;0100 UTC;0;888,1;888,1;887,7;;19,2;17,5;20,1;19,2;17,8;17,4;90;87;90;153;2,9;,8;
2023/01/01;0200 UTC;0;887,8;888,1;887,8;;19,3;17,6;19,5;19;17,8;17,3;90;89;90;145;2,5;1,5;
2023/01/01;0300 UTC;0;887,8;887,9;887,7;;19,3;17,7;19,4;19,1;17,8;17,5;91;90;91;162;3,2;1,4;
2023/01/01;0400 UTC;0;887,6;887,9;887,6;;19,7;18,1;19,7;19,1;18,1;17,4;91;90;90;140;5,7;2,7;
2023/01/01;0500 UTC;0;886,7;887,6;886,7;;19,1;17,7;19,7;19,1;18,1;17,7;92;90;92;128;7,1;2;""",
        """REGIAO:;CO
UF:;DF
ESTACAO:;BRAZLANDIA
CODIGO (WMO):;A042
LATITUDE:;-15,59972221
LONGITUDE:;aaaaaaa
ALTITUDE:;1143
DATA DE FUNDACAO:;19/07/17
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;0;888,7;888,9;888,2;;20,5;18;21;20,5;18,4;18;87;84;86;146;3,9;1,8;
2023/01/01;0100 UTC;0;889;889;888,7;;20,4;17,5;20,5;20,3;18;17,5;86;84;84;142;4,1;1,8;
2023/01/01;0200 UTC;0;888,9;889,1;888,9;;19,9;17,4;20,4;19,8;17,5;17,3;86;83;86;153;4;,2;
2023/01/01;0300 UTC;0;888,7;888,9;888,7;;19,8;17,4;19,9;19,7;17,4;17,2;87;85;86;140;3,5;1,2;
2023/01/01;0400 UTC;0;888,4;888,8;888,4;;20,1;17,3;20,1;19,8;17,5;17,3;86;84;84;139;3,3;,3;
2023/01/01;0500 UTC;0;887,8;888,4;887,8;;19,8;17,6;20,3;19,8;17,6;17,2;87;83;87;138;5,2;1,3;
2023/01/01;0600 UTC;0;887,5;887,9;887,5;;19,6;17,3;19,8;19,5;17,7;17,3;89;87;87;133;4,1;,3;
2023/01/01;0700 UTC;0;887,5;887,5;887,3;;19,1;17,3;19,6;19,1;17,3;17,2;89;87;89;95;4,4;1,4;
2023/01/01;0800 UTC;0;887,6;887,6;887,5;;18,9;17,1;19,2;18,3;17,5;16,9;92;89;89;49;5,5;2,4;
2023/01/01;0900 UTC;0;888;888;887,4;5,3;18,8;17;19,1;18,4;17,1;16,6;90;88;89;73;4,8;,6;""",
        """REGIAO:;N
UF:;AM
ESTACAO:;COARI
CODIGO (WMO):;A117
LATITUDE:;-4,09749999
LONGITUDE:;-63,14527777
ALTITUDE:;33,84
DATA DE FUNDACAO:;12/04/08
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0100 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0200 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0300 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0400 UTC;;;;;;;;;;;;;;;;;;""",
    ]

    create_files(temp_stage_invalid, csv_data_infos)

    yield temp_stage_invalid, temp_output_invalid


@pytest.fixture()
def tmp_station_mixed_data(tmp_path):
    """Create a temporary folder to test the StationDataCollector with mixed data."""
    temp_stage_mixed = tmp_path / "stage-mixed"
    temp_stage_mixed.mkdir()
    temp_output_mixed = tmp_path / "output-mixed"
    temp_output_mixed.mkdir()

    csv_data_infos = [
        """REGIAO:;CO
UF:;DF
ESTACAO:;BRASILIA
CODIGO (WMO):;A001
LATITUDE:;aaaaaaaaaa
LONGITUDE:;-47,92583332
ALTITUDE:;1160,96
DATA DE FUNDACAO:;07/05/00
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;0;887,7;887,7;887,2;;20,1;17,9;20,9;20;19,2;17,8;91;87;87;187;3,3;1,2;
2023/01/01;0100 UTC;0;888,1;888,1;887,7;;19,2;17,5;20,1;19,2;17,8;17,4;90;87;90;153;2,9;,8;
2023/01/01;0200 UTC;0;887,8;888,1;887,8;;19,3;17,6;19,5;19;17,8;17,3;90;89;90;145;2,5;1,5;
2023/01/01;0300 UTC;0;887,8;887,9;887,7;;19,3;17,7;19,4;19,1;17,8;17,5;91;90;91;162;3,2;1,4;
2023/01/01;0400 UTC;0;887,6;887,9;887,6;;19,7;18,1;19,7;19,1;18,1;17,4;91;90;90;140;5,7;2,7;
2023/01/01;0500 UTC;0;886,7;887,6;886,7;;19,1;17,7;19,7;19,1;18,1;17,7;92;90;92;128;7,1;2;""",
        """REGIAO:;CO
UF:;DF
ESTACAO:;BRAZLANDIA
CODIGO (WMO):;A042
LATITUDE:;-15,59972221
LONGITUDE:;-48,1311111
ALTITUDE:;1143
DATA DE FUNDACAO:;19/07/17
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;0;888,7;888,9;888,2;;20,5;18;21;20,5;18,4;18;87;84;86;146;3,9;1,8;
2023/01/01;0100 UTC;0;889;889;888,7;;20,4;17,5;20,5;20,3;18;17,5;86;84;84;142;4,1;1,8;
2023/01/01;0200 UTC;0;888,9;889,1;888,9;;19,9;17,4;20,4;19,8;17,5;17,3;86;83;86;153;4;,2;
2023/01/01;0300 UTC;0;888,7;888,9;888,7;;19,8;17,4;19,9;19,7;17,4;17,2;87;85;86;140;3,5;1,2;
2023/01/01;0400 UTC;0;888,4;888,8;888,4;;20,1;17,3;20,1;19,8;17,5;17,3;86;84;84;139;3,3;,3;
2023/01/01;0500 UTC;0;887,8;888,4;887,8;;19,8;17,6;20,3;19,8;17,6;17,2;87;83;87;138;5,2;1,3;
2023/01/01;0600 UTC;0;887,5;887,9;887,5;;19,6;17,3;19,8;19,5;17,7;17,3;89;87;87;133;4,1;,3;
2023/01/01;0700 UTC;0;887,5;887,5;887,3;;19,1;17,3;19,6;19,1;17,3;17,2;89;87;89;95;4,4;1,4;
2023/01/01;0800 UTC;0;887,6;887,6;887,5;;18,9;17,1;19,2;18,3;17,5;16,9;92;89;89;49;5,5;2,4;
2023/01/01;0900 UTC;0;888;888;887,4;5,3;18,8;17;19,1;18,4;17,1;16,6;90;88;89;73;4,8;,6;""",
        """REGIAO:;N
UF:;AM
ESTACAO:;COARI
CODIGO (WMO):;A117
LATITUDE:;-4,09749999
LONGITUDE:;-63,14527777
ALTITUDE:;33,84
DATA DE FUNDACAO:;12/04/08
Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
2023/01/01;0000 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0100 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0200 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0300 UTC;;;;;;;;;;;;;;;;;;
2023/01/01;0400 UTC;;;;;;;;;;;;;;;;;;""",
    ]

    create_files(temp_stage_mixed, csv_data_infos)

    yield temp_stage_mixed, temp_output_mixed


class TestStationDataCollector:
    def test_collecting_empty_folder(self, tmp_path_factory):
        """Test StationData class to ensure it raise an error when
        scan a empty folder.

        This test simulates a start method using an empty folder.

        Parameters:
        tmp_path_factory : The path to a temporary folder provided by a
        fixture.

        Asserts:
        The class will raise an error when pointed to an empty folder.
        """
        stage_empty = tmp_path_factory.mktemp("stage_empty")
        output_empty = tmp_path_factory.mktemp("output_empty")

        stations_data = StationDataCollector(
            stage_empty,
            output_empty,
            STATIONS_FILE,
            STATION_COLUMN_NAMES,
            StationData,
        )

        with pytest.raises(ValueError) as excinfo:
            stations_data.start()
        assert "No CSV files found in the specified folder." in str(
            excinfo.value,
        )

    def test_collecting_valid_data(self, tmp_station_valid_data):
        """Test the StationData class to ensure the log file creation.

        This test simulates a start method using a folder with valid data.
        After the method, any log file should be created.

        Parameters:
        tmp_path_factory : The path to a temporary folder provided by a
        fixture.

        Asserts:
        The class will raise an error when pointed to an empty folder.
        """
        stage_valid, output_valid = tmp_station_valid_data

        stations_data = StationDataCollector(
            stage_valid,
            output_valid,
            STATIONS_FILE,
            STATION_COLUMN_NAMES,
            StationData,
        )

        stations_data.start()

        log_file_path = output_valid / (STATIONS_FILE + "_invalid_records.log")

        assert not os.path.exists(log_file_path)


if __name__ == "__main__":
    test_data = [
        """REGIAO:;CO
        UF:;DF
        ESTACAO:;BRASILIA
        CODIGO (WMO):;A001
        LATITUDE:;-15,78944444
        LONGITUDE:;-47,92583332
        ALTITUDE:;1160,96
        DATA DE FUNDACAO:;07/05/00
        Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
        2023/01/01;0000 UTC;0;887,7;887,7;887,2;;20,1;17,9;20,9;20;19,2;17,8;91;87;87;187;3,3;1,2;
        2023/01/01;0100 UTC;0;888,1;888,1;887,7;;19,2;17,5;20,1;19,2;17,8;17,4;90;87;90;153;2,9;,8;
        2023/01/01;0200 UTC;0;887,8;888,1;887,8;;19,3;17,6;19,5;19;17,8;17,3;90;89;90;145;2,5;1,5;
        2023/01/01;0300 UTC;0;887,8;887,9;887,7;;19,3;17,7;19,4;19,1;17,8;17,5;91;90;91;162;3,2;1,4;
        2023/01/01;0400 UTC;0;887,6;887,9;887,6;;19,7;18,1;19,7;19,1;18,1;17,4;91;90;90;140;5,7;2,7;
        2023/01/01;0500 UTC;0;886,7;887,6;886,7;;19,1;17,7;19,7;19,1;18,1;17,7;92;90;92;128;7,1;2;""",
        """REGIAO:;CO
        UF:;DF
        ESTACAO:;BRAZLANDIA
        CODIGO (WMO):;A042
        LATITUDE:;-15,59972221
        LONGITUDE:;-48,1311111
        ALTITUDE:;1143
        DATA DE FUNDACAO:;19/07/17
        Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
        2023/01/01;0000 UTC;0;888,7;888,9;888,2;;20,5;18;21;20,5;18,4;18;87;84;86;146;3,9;1,8;
        2023/01/01;0100 UTC;0;889;889;888,7;;20,4;17,5;20,5;20,3;18;17,5;86;84;84;142;4,1;1,8;
        2023/01/01;0200 UTC;0;888,9;889,1;888,9;;19,9;17,4;20,4;19,8;17,5;17,3;86;83;86;153;4;,2;
        2023/01/01;0300 UTC;0;888,7;888,9;888,7;;19,8;17,4;19,9;19,7;17,4;17,2;87;85;86;140;3,5;1,2;
        2023/01/01;0400 UTC;0;888,4;888,8;888,4;;20,1;17,3;20,1;19,8;17,5;17,3;86;84;84;139;3,3;,3;
        2023/01/01;0500 UTC;0;887,8;888,4;887,8;;19,8;17,6;20,3;19,8;17,6;17,2;87;83;87;138;5,2;1,3;
        2023/01/01;0600 UTC;0;887,5;887,9;887,5;;19,6;17,3;19,8;19,5;17,7;17,3;89;87;87;133;4,1;,3;
        2023/01/01;0700 UTC;0;887,5;887,5;887,3;;19,1;17,3;19,6;19,1;17,3;17,2;89;87;89;95;4,4;1,4;
        2023/01/01;0800 UTC;0;887,6;887,6;887,5;;18,9;17,1;19,2;18,3;17,5;16,9;92;89;89;49;5,5;2,4;
        2023/01/01;0900 UTC;0;888;888;887,4;5,3;18,8;17;19,1;18,4;17,1;16,6;90;88;89;73;4,8;,6;""",
        """REGIAO:;N
        UF:;AM
        ESTACAO:;COARI
        CODIGO (WMO):;A117
        LATITUDE:;-4,09749999
        LONGITUDE:;-63,14527777
        ALTITUDE:;33,84
        DATA DE FUNDACAO:;12/04/08
        Data;Hora UTC;PRECIPITAÇÃO TOTAL, HORÁRIO (mm);PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB);PRESSÃO ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB);PRESSÃO ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB);RADIACAO GLOBAL (Kj/m²);TEMPERATURA DO AR - BULBO SECO, HORARIA (°C);TEMPERATURA DO PONTO DE ORVALHO (°C);TEMPERATURA MÁXIMA NA HORA ANT. (AUT) (°C);TEMPERATURA MÍNIMA NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MAX. NA HORA ANT. (AUT) (°C);TEMPERATURA ORVALHO MIN. NA HORA ANT. (AUT) (°C);UMIDADE REL. MAX. NA HORA ANT. (AUT) (%);UMIDADE REL. MIN. NA HORA ANT. (AUT) (%);UMIDADE RELATIVA DO AR, HORARIA (%);VENTO, DIREÇÃO HORARIA (gr) (° (gr));VENTO, RAJADA MAXIMA (m/s);VENTO, VELOCIDADE HORARIA (m/s);
        2023/01/01;0000 UTC;;;;;;;;;;;;;;;;;;
        2023/01/01;0100 UTC;;;;;;;;;;;;;;;;;;
        2023/01/01;0200 UTC;;;;;;;;;;;;;;;;;;
        2023/01/01;0300 UTC;;;;;;;;;;;;;;;;;;
        2023/01/01;0400 UTC;;;;;;;;;;;;;;;;;;""",
    ]

    destino = pathlib.Path("./test")

    create_files(destino, test_data)
